// file: src/app/sitemap.ts
import { MetadataRoute } from 'next';
import prisma from '@/lib/prisma';
import { routing } from '@/i18n/routing';

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const siteUrl = 'https://evsi.store';
  const { locales } = routing;

  const applications = await prisma.application.findMany({
    select: {
      slug: true,
      updatedAt: true,
    },
  });

  const appUrls = applications.flatMap((app) =>
    locales.map((locale) => ({
      url: `${siteUrl}/${locale}/app/${app.slug}`,
      lastModified: app.updatedAt,
    }))
  );

  const staticPages = ['/', '/about', '/privacy'];
  const staticUrls = staticPages.flatMap((path) =>
    locales.map((locale) => ({
      url: `${siteUrl}/${locale}${path === '/' ? '' : path}`,
      lastModified: new Date(),
    }))
  );

  return [...staticUrls, ...appUrls];
}
